<!DOCTYPE html>
<html>
  <head>
    <title>Force-Directed Layout (Multiple Foci)</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?1.27.2"></script>
  </head>
  
<style>
body{
    font-family: 'helvetica';
    font-size:12px;
    color: #000;
    margin:0px;
}

p{
    font-size:13px;
    line-height: 16px;
}

.node {
  cursor: pointer;
  stroke: #3182bd;
  stroke-width: 0px;
  text-decoration: none;
}

.node circle{
  opacity:0.0;
}

.node text {
  font: 15px sans-serif;
  position:absolute;
  stroke-width: 0px;
  /*stroke: #000000;*/
  fill:#ffffff;
  z-index:50;
  pointer-events:none;
 
}

#unSort{
  position:absolute;
  display:inline;
}

</style>  
  
  <body>
    
    <div id="sort">Sort items</div><span id="unSort">unsort</span>
    
    <script type="text/javascript">

var w = 960,
    h = 750,
    fill = d3.scale.category10();

var svg = d3.select("body").append("svg:svg")
    .attr("width", w)
    .attr("height", h);


    
//var newDict = {};
var commasFormatter = d3.format(",.0f");
var radius_scale = d3.scale.pow().exponent(0.5).domain([0, 107848]).range([2, 110]);

d3.json("data/hopeNums.json", function(json) {
  var force = d3.layout.force()
    .gravity(0.05)
    .charge(function(d, i) { return d.students*-.017; })
    .nodes(json.nodes)
    .size([w, h])
    .links([])
    .start();
    
      

var node = svg.selectAll(".node")
        .data(json.nodes)
        .enter().append("svg:g")
        .attr("class", "node");

node.append("image")
      //.on("click", function(d) {
  //})
      .attr("xlink:href", (function(d) { return d.img; }))
      .attr("x", function(d) { return (radius_scale(parseInt(d.students))*-1); })
      .attr("y", function(d) { return (radius_scale(parseInt(d.students))*-1); })
      .attr("width", function(d) { return (radius_scale(parseInt(d.students))*2); })
      .attr("height", function(d) { return (radius_scale(parseInt(d.students))*2); });

node.append("text")
      .attr("dx", 0)
      .attr("dy", function(d) { return (radius_scale(parseInt(d.students))*.7); })
      .attr("text-anchor", "middle")
      .text(function(d) { return commasFormatter(d.students); });      
      
node.append("svg:circle")
        //.attr("cx", function(d) { return d.x; })
        //.attr("cy", function(d) { return d.y; })
        .attr("title", function(d) { return d.colleges; })
        .attr("r", function(d) { return radius_scale(parseInt(d.students)); })
        .attr("fill", function(d) { return d.fill; })
        .attr("stroke", function(d) { return d.stroke; })
        .call(force.drag);

svg.style("opacity", 1e-6)
  .transition()
    .duration(1000)
    .style("opacity", 1);      
      
force.on("tick", function(e) {
node.forEach(function(o, i) {
    o.x += (Math.random() - .5) * 40;
    o.y += (Math.random() - .5) * 40;
  });
  //force.resume();
  
  //Doesn't do anything, but might help to make crazy at beginning
  /*node.attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; });*/

      svg.selectAll("circle").attr("transform", function(d) {
        return "translate(" + d.x + "," + d.y + ")";
      });
      
      svg.selectAll("image").attr("transform", function(d) {
        return "translate(" + d.x + "," + d.y + ")";
      });

      svg.selectAll("text").attr("transform", function(d) {
        return "translate(" + d.x + "," + d.y + ")";
      });
    });
d3.select("#sort").on("click", function(e){
  force.on("tick", function(e) {
      svg.selectAll("circle").attr("transform", function(d) {
        return "translate(" + d.xValue + "," + d.y + ")";
      });
      
      svg.selectAll("image").attr("transform", function(d) {
        return "translate(" + d.xValue + "," + d.y + ")";
      });

      svg.selectAll("text").attr("transform", function(d) {
        return "translate(" + d.xValue + "," + d.y + ")";
      });
    });
  });
  
d3.select("#unSort").on("click", function(e){
  force.on("tick", function(e) {
      svg.selectAll("circle").attr("transform", function(d) {
        return "translate(" + d.x + "," + d.y + ")";
      });
      
      svg.selectAll("image").attr("transform", function(d) {
        return "translate(" + d.x + "," + d.y + ")";
      });

      svg.selectAll("text").attr("transform", function(d) {
        return "translate(" + d.x + "," + d.y + ")";
      });
    });
  });
});

    </script>
  </body>
</html>